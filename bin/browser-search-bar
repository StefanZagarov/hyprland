#!/bin/bash
browser="${BROWSER:-firefox}"

# URL encode function using pure bash
urlencode() {
    local string="$1"
    local strlen=${#string}
    local encoded=""
    local pos c o

    for (( pos=0 ; pos<strlen ; pos++ )); do
        c=${string:$pos:1}
        case "$c" in
            [-_.~a-zA-Z0-9] ) o="$c" ;;
            * ) printf -v o '%%%02x' "'$c"
        esac
        encoded+="$o"
    done
    echo "$encoded"
}

query=$(
    rofi -dmenu -theme ~/.config/rofi/browser-search-bar.rasi -p "Search Web" \
         -theme-str "entry { placeholder: \"Search with ${browser}...\"; }" \
         -lines 0)

# nothing typed? just quit
[ -z "$query" ] && exit

# open the query in the browser
encoded_query=$(urlencode "$query")
"$browser" "https://www.google.com/search?q=$encoded_query"
