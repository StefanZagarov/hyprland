#!/bin/bash
# A G-Helper-style mode switcher - v3 (Updated for new asusctl)
# Notification ID
NOTIFY_ID=9999

set_mode() {
    case $1 in
        Quiet)
            sudo asusctl profile set Quiet
            echo "1" | sudo tee /sys/devices/system/cpu/intel_pstate/no_turbo > /dev/null
            notify-send -u low -r $NOTIFY_ID "Mode Control" "󰌪  Quiet"
            ;;
        Balanced)
            sudo asusctl profile set Balanced
            echo "0" | sudo tee /sys/devices/system/cpu/intel_pstate/no_turbo > /dev/null
            notify-send -u low -r $NOTIFY_ID "Mode Control" "  Balanced"
            ;;
        Performance)
            sudo asusctl profile set Performance
            echo "0" | sudo tee /sys/devices/system/cpu/intel_pstate/no_turbo > /dev/null
            notify-send -u low -r $NOTIFY_ID "Mode Control" "  Performance"
            ;;
    esac
}

# --- Cycle Logic ---
if [ -z "$1" ]; then
    # Get current profile - extract from "Active profile: X" line
    CURRENT=$(asusctl profile get | grep "Active profile:" | awk '{print $3}')
    
    if [ -z "$CURRENT" ]; then
        echo "Warning: Could not detect current profile" >&2
        set_mode Balanced
        exit 0
    fi
    
    case "$CURRENT" in
        Quiet)
            set_mode Balanced
            ;;
        Balanced)
            set_mode Performance
            ;;
        Performance)
            set_mode Quiet
            ;;
    esac
else
    set_mode "$1"
fi
